const quizData = {
    "Teoria do Scrum": [
        {
            question: "Qual é o principal objetivo do Scrum?",
            a: "Reduzir o número de reuniões",
            b: "Entregar um produto completo em uma única etapa",
            c: "Incrementar o valor do produto de forma contínua", 
            d: "Seguir rigorosamente o plano inicial",
            correct: "c"
        },
        {
            question: "Quem idealizou o framework Scrum?",
            a: "Jeff Bezos e Elon Musk",
            b: "Ken Schwaber e Jeff Sutherland", 
            c: "Mike Beedle e Bill Gates",
            d: "Steve Jobs e Mike Beedle",
            correct: "b"
        },
        {
            question: "Qual princípio orienta as equipes no Scrum?",
            a: "Estrutura hierárquica rígida",
            b: "Flexibilidade e adaptação", 
            c: "Documentação detalhada obrigatória",
            d: "Processo unificado para todas as equipes",
            correct: "b"
        },
        {
            question: "Qual é o foco do Scrum em relação ao trabalho em equipe?",
            a: "Definir funções fixas e inalteráveis",
            b: "Estimular a auto-organização e multifuncionalidade",
            c: "Centralizar decisões no Scrum Master",
            d: "Limitar a colaboração",
            correct: "b"
        },
        {
            question: "Qual termo, originado do rugby, inspira o Scrum?",
            a: "Goal Kick",
            b: "Scrum", 
            c: "Offside",
            d: "Tackle",
            correct: "b"
        }
     ],
    "Como aplicar o scrum": [
        {
            question: "Qual evento Scrum inicia o planejamento da Sprint?",
            a: "Sprint Review",
            b: "Sprint Planning", 
            c: "Daily Scrum",
            d: "Sprint Retrospective",
            correct: "b"
        },
        {
            question: "O que deve ser feito diariamente para alinhar o progresso?",
            a: "Sprint Review",
            b: "Sprint Planning",
            c: "Daily Scrum", 
            d: "Sprint Retrospective",
            correct: "c"
        },
        {
            question: "Durante qual evento os itens do backlog são detalhados e priorizados?",
            a: "Backlog Refinement", 
            b: "Sprint Review",
            c: "Daily Scrum",
            d: "Sprint Retrospective",
            correct: "a"
        },
        {
            question: "Qual é o principal objetivo da Sprint Review?",
            a: "Revisar o trabalho concluído com os stakeholders", 
            b: "Identificar melhorias no processo",
            c: "Alinhar metas diárias da equipe",
            d: "Planejar o próximo Sprint",
            correct: "a"
        },
        {
            question: "Qual é o papel do Sprint Goal?",
            a: "Determinar a quantidade de trabalho realizado",
            b: "Orientar o objetivo do time durante a Sprint", 
            c: "Listar tarefas individuais",
            d: "Garantir o prazo final do projeto",
            correct: "b"
        }
    ],
    "Vantagens do scrum": [
        {
            question: "Qual vantagem o Scrum oferece às equipes?",
            a: "Ritmo de trabalho insustentável",
            b: "Melhoria contínua", 
            c: "Redução do tempo de planejamento",
            d: "Trabalho individual mais eficiente",
            correct: "b"
        },
        {
            question: "Como o Scrum mantém a motivação da equipe?",
            a: "Ao definir prazos rigorosos",
            b: "Ao promover autonomia e auto-organização", 
            c: "Ao eliminar reuniões",
            d: "Ao centralizar decisões no Product Owner",
            correct: "b"
        },
        {
            question: "Qual benefício é resultado da remoção de impedimentos no Scrum?",
            a: "Processo mais eficiente", 
            b: "Menos revisões necessárias",
            c: "Menor participação dos stakeholders",
            d: "Maior dependência de liderança",
            correct: "a"
        },
        {
            question: "Por que o Scrum é considerado flexível?",
            a: "Permite mudanças frequentes para melhor alinhamento com o objetivo", 
            b: "Dispensa o uso de artefatos",
            c: "Não requer reuniões regulares",
            d: "Exige documentação detalhada",
            correct: "a"
        },
        {
            question: "Qual fator do Scrum facilita o desenvolvimento ágil?",
            a: "Uso obrigatório de ferramentas específicas",
            b: "Incrementos pequenos e frequentes", 
            c: "Planejamento detalhado de longo prazo",
            d: "Equipe especializada e hierarquizada",
            correct: "b"
        }
    ],
    "Perfis scrum": [
        {
            question: "Qual é o principal papel do Product Owner (P.O.) no Scrum?",
            a: "Desenvolver código de software",
            b: "Facilitar reuniões diárias",
            c: "Maximizar o valor do produto", 
            d: "Gerenciar a equipe de desenvolvimento",
            correct: "c"
        },
        {
            question: "Quem facilita a equipe Scrum e garante que o processo ágil seja seguido?",
            a: "Desenvolvedor",
            b: "Product Owner",
            c: "Scrum Master", 
            d: "Stakeholder",
            correct: "c"
        },
        {
            question: "Quem são os responsáveis por criar incrementos utilizáveis em cada Sprint?",
            a: "Scrum Master",
            b: "Product Owner",
            c: "Desenvolvedores", 
            d: "Stakeholders",
            correct: "c"
        },
        {
            question: "Qual é o papel do Scrum Master em relação aos impedimentos?",
            a: "Garantir que o Product Owner os resolva",
            b: "Delegar sua solução aos stakeholders",
            c: "Removê-los para manter o fluxo de trabalho",
            d: "Evitá-los sem alterar processos",
            correct: "c"
        },
        {
            question: "Qual o papel dos stakeholders no Scrum?",
            a: "Participar das reuniões diárias",
            b: "Decidir quais itens serão desenvolvidos",
            c: "Fornecer feedback durante o Sprint Review", 
            d: "Coordenar o time de desenvolvimento",
            correct: "c"
        }
    ],
    "Sprints": [
        {
            question: "O que é o Sprint?",
            a: "Um ciclo de trabalho fixo onde se cria um incremento utilizável", 
            b: "Um evento semanal de revisão",
            c: "Um planejamento futuro",
            d: "Um conjunto de tarefas técnicas",
            correct: "a"
        },
        {
            question: "O que define o sucesso de um Sprint?",
            a: "O número de tarefas completadas",
            b: "A entrega do Increment que atende à Definition of Done", 
            c: "A ausência de reuniões durante o ciclo",
            d: "A conclusão do Sprint Planning",
            correct: "b"
        },
        {
            question: "O que é Sprint Backlog?",
            a: "Uma lista de tarefas concluídas",
            b: "Itens do Product Backlog selecionados para a Sprint atual", 
            c: "Uma lista de erros encontrados",
            d: "Um relatório de progresso",
            correct: "b"
        },
        {
            question: "Qual o foco da Sprint Retrospective?",
            a: "Revisar o produto com os stakeholders",
            b: "Avaliar o desempenho da equipe e o processo", 
            c: "Planejar o próximo Sprint",
            d: "Definir o Increment",
            correct: "b"
        },
        {
            question: "O que é definido no Sprint Goal?",
             a: "As metas para os stakeholders",
             b: "O objetivo principal que a equipe espera alcançar durante a Sprint", 
             c: "As tarefas de revisão",
             d: "O relatório final de progresso",
             correct: "b"
         }
     ]
};


const quiz = document.getElementById("quiz");
const submitButton = document.getElementById("submit");
const results = document.getElementById("results");

const cpfInvalido = ['00000000000', '11111111111', '22222222222', '33333333333', '44444444444', '55555555555', '66666666666', '77777777777', '88888888888', '99999999999'];
let currentCategory = Object.keys(quizData)[0];
let currentQuestionIndex = 0;
let scoreByCategory = {};
let selectedAnswer = null;
let hasAnswered = false;
let categoria = document.getElementById("Categoria");
let titulo = document.getElementById("titulo");
let numero = 1;

Object.keys(quizData).forEach(category => {
    scoreByCategory[category] = 0;
});

function loadQuiz() {
    const currentQuizData = quizData[currentCategory][currentQuestionIndex];
    hasAnswered = false;
    categoria.innerHTML = currentCategory;
    quiz.innerHTML = `
        <div class="question">${numero}/25 ${currentQuizData.question}</div>
        <button class="alternative-button" data-answer="a">${currentQuizData.a}</button>
        <button class="alternative-button" data-answer="b">${currentQuizData.b}</button>
        <button class="alternative-button" data-answer="c">${currentQuizData.c}</button>
        <button class="alternative-button" data-answer="d">${currentQuizData.d}</button>
    `;

    document.querySelectorAll('.alternative-button').forEach(button => {
        button.addEventListener('click', () => {
            document.querySelectorAll('.alternative-button').forEach(btn => btn.classList.remove('selected'));
            button.classList.add('selected');
            selectedAnswer = button.getAttribute('data-answer');
        });
    });
}

function highlightAnswers() {
    const correctAnswer = quizData[currentCategory][currentQuestionIndex].correct;

    document.querySelectorAll('.alternative-button').forEach(button => {
        const answer = button.getAttribute('data-answer');
        if (answer === correctAnswer) {
            button.classList.add('correct'); 
        } else if (answer === selectedAnswer && answer !== correctAnswer) {
            button.classList.add('wrong');  
        }
    });
}

function showResults() {
    categoria.style.display = "none"
    titulo.style.display = "none"
    quiz.innerHTML = '';
    results.innerHTML = Object.keys(scoreByCategory)
        .map(category => `Categoria <strong>${category}</strong> : ${scoreByCategory[category]} acertos.`)
        .join('<br>');
    submitButton.style.display = 'none'; 
    let numeroId = 1;
    for (let i = 0; i < 5; i++) { 
        document.getElementById('pts-'+numeroId).setAttribute('value',scoreByCategory[Object.keys(quizData)[i]]);
        numeroId++;
    }
    document.getElementById('form').style.display = 'initial';
    document.getElementById('env').style.display = 'none';

    const restartButton = document.createElement('button');
    restartButton.classList.add("restart");
    restartButton.innerText = 'Reiniciar Quiz';
    restartButton.style.borderRadius = "10px"
    restartButton.classList.add('restart-button');
    quiz.appendChild(restartButton);
    restartButton.addEventListener('click', restartQuiz);
}

function nextQuestion() {
    numero++;
    if (selectedAnswer === quizData[currentCategory][currentQuestionIndex].correct) {
        scoreByCategory[currentCategory]++;
    }

    setTimeout(() => {
        currentQuestionIndex++;
        if (currentQuestionIndex >= quizData[currentCategory].length) {
            const categories = Object.keys(quizData);
            const currentIndex = categories.indexOf(currentCategory);

            if (currentIndex + 1 < categories.length) {
                currentCategory = categories[currentIndex + 1];
                currentQuestionIndex = 0;
            } else {
                showResults();
                return;
            }
        }
        loadQuiz();
    }, 1000);
}

function restartQuiz() {
    currentCategory = Object.keys(quizData)[0];
    currentQuestionIndex = 0;
    Object.keys(scoreByCategory).forEach(category => {
        scoreByCategory[category] = 0;
    });
    selectedAnswer = null;
    results.innerHTML = '';
    numero = 1;
    document.getElementById('form').style.display = 'none';
    submitButton.style.display = 'block';
    loadQuiz();
}

submitButton.addEventListener("click", () => {
    if (!hasAnswered) {
        if (selectedAnswer) {
            highlightAnswers(); 
            hasAnswered = true;
            nextQuestion();
            selectedAnswer = null;
        } else {
            alert("Por favor, selecione uma resposta!");
        }
    }
});

loadQuiz();

const cpf = document.getElementById("CPF");
let msg = document.getElementById("msg");
let enviar = document.getElementById("env")

cpf.addEventListener("input", () => {
    let cpfmod = cpf.value.replace(/\D/g, ""); 
    if (cpfmod.length === 0) {
        msg.innerText = ""; 
    }

    if (cpfmod.length <= 3) {
        cpf.value = cpfmod;
    } else if (cpfmod.length <= 6) {
        cpf.value = `${cpfmod.slice(0, 3)}.${cpfmod.slice(3)}`;
    } else if (cpfmod.length <= 9) {
        cpf.value = `${cpfmod.slice(0, 3)}.${cpfmod.slice(3, 6)}.${cpfmod.slice(6)}`;
    } else {
        cpf.value = `${cpfmod.slice(0, 3)}.${cpfmod.slice(3, 6)}.${cpfmod.slice(6, 9)}-${cpfmod.slice(9, 11)}`;
    }

    if (cpfmod.length === 11) {
        console.log(cpfmod);
        calcularCPF(cpfmod);
    }
});

function calcularCPF(cpfmod) {
    let soma = 0;
    let cpfInvalidoString = '' + cpfmod;
    let cpfValido = 0;

    for (let i = 0;i < 10;i++){
        if (cpfInvalidoString == cpfInvalido[i]){
            cpfValido = 1;
        }
    }
    console.log(cpfInvalidoString === cpfInvalido[1])
    for (let i = 0; i < 9; i++) {
        soma += cpfmod[i] * (10 - i); 
    }
    let primeiroDigito = (soma * 10) % 11;
    if (primeiroDigito === 10) {
        primeiroDigito = 0; 
    }

    if (primeiroDigito == cpfmod[9] && cpfValido == 0) {
        soma = 0;

        for (let i = 0; i < 10; i++) {
            soma += cpfmod[i] * (11 - i); 
        }

        primeiroDigito = (soma * 10) % 11;

        if (primeiroDigito === 10) {
            primeiroDigito = 0; 
        }
        if (primeiroDigito == cpfmod[10]) {
            console.log("CPF VALIDADO COM SUCESSO");
            msg.innerText = "CPF VÁLIDO";
            msg.style.color = "green";
            cpf.style.boxShadow = "0px 0px 5px 5px green, 0px 0px 5px 3px green";
            enviar.style.display = 'initial';
            
        } else {
            console.log("CPF INVÁLIDO");
            msg.innerText = "CPF INVÁLIDO";
            msg.style.color = "red";
            cpf.style.boxShadow = "0px 0px 5px 5px red, 0px 0px 5px 3px red";
            enviar.style.display = 'none';
        }
    } else {
        console.log("CPF INVÁLIDO");
        msg.innerText = "CPF INVÁLIDO";
        msg.style.color = "red";
        cpf.style.boxShadow = "0px 0px 5px 5px red, 0px 0px 5px 3px red";
        enviar.style.display = 'none';
    }
}

const tecla = document.getElementById("Form") 
tecla.addEventListener('keydown', function(enter) {
    if (enter.key === "Enter") {
        enter.preventDefault();
    }
});